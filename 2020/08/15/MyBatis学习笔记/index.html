<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyBatis学习笔记 | Leric</title><meta name="description" content="MyBatislog4j日志添加依赖 12345&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;&#x2F;artifactId&gt; &lt;version&gt;1.7.30&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;  编写配置文件"><meta name="keywords" content="MyBatis"><meta name="author" content="Leric"><meta name="copyright" content="Leric"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://s1.ax1x.com/2020/08/21/dteT7F.png"><link rel="canonical" href="http://lyric-git.gitee.io/Lyric-git/2020/08/15/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="MyBatis学习笔记"><meta property="og:url" content="http://lyric-git.gitee.io/Lyric-git/2020/08/15/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="Leric"><meta property="og:description" content="MyBatislog4j日志添加依赖 12345&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;&#x2F;artifactId&gt; &lt;version&gt;1.7.30&lt;&#x2F;version&gt;&lt;&#x2F;dependency&gt;  编写配置文件"><meta property="og:image" content="https://s1.ax1x.com/2020/08/21/dtaViR.jpg"><meta property="article:published_time" content="2020-08-15T07:29:22.000Z"><meta property="article:modified_time" content="2020-08-21T07:32:28.944Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/Lyric-git/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/Lyric-git/',
  hexoversion: '5.0.2',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-21 15:32:28'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.0.2"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://s1.ax1x.com/2020/08/21/dYbiKf.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/Lyric-git/archives/"><div class="headline">文章</div><div class="length_num">3</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/Lyric-git/tags/"><div class="headline">标签</div><div class="length_num">2</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/Lyric-git/categories/"><div class="headline">分类</div><div class="length_num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Lyric-git/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/about/"><i class="fa-fw fas fa-user"></i><span> 我</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis"><span class="toc-number">1.</span> <span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#log4j%E6%97%A5%E5%BF%97"><span class="toc-number">1.1.</span> <span class="toc-text">log4j日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">主函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.3.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">映射器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.</span> <span class="toc-text">简单查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Select%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.5.1.</span> <span class="toc-text">Select语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.5.2.</span> <span class="toc-text">insert语句</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E5%9B%9E%E5%A1%AB"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">主键回填</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.5.3.</span> <span class="toc-text">update语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.5.4.</span> <span class="toc-text">delete语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis%E8%BD%AC%E4%B9%89"><span class="toc-number">1.5.5.</span> <span class="toc-text">MyBatis转义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%88%AB%E5%90%8D"><span class="toc-number">1.5.6.</span> <span class="toc-text">配置别名</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.6.</span> <span class="toc-text">复杂查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80%E6%9F%A5%E8%AF%A2association"><span class="toc-number">1.6.1.</span> <span class="toc-text">一对一查询association</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%9F%A5%E8%AF%A2collection"><span class="toc-number">1.6.2.</span> <span class="toc-text">一对多查询collection</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E4%B8%8E%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.7.</span> <span class="toc-text">缓存与懒加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.7.1.</span> <span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-number">1.7.2.</span> <span class="toc-text">二级缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%BC%94%E7%A4%BA"><span class="toc-number">1.7.3.</span> <span class="toc-text">二级缓存演示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.7.4.</span> <span class="toc-text">懒加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.8.</span> <span class="toc-text">数据库事务</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/08/21/dtaViR.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/Lyric-git/">Leric</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/Lyric-git/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/Lyric-git/about/"><i class="fa-fw fas fa-user"></i><span> 我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">MyBatis学习笔记</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-15T07:29:22.000Z" title="发表于 2020-08-15 15:29:22">2020-08-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-08-21T07:32:28.944Z" title="更新于 2020-08-21 15:32:28">2020-08-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/Lyric-git/categories/code/">code</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/Lyric-git/categories/code/Java/">Java</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h3 id="log4j日志"><a href="#log4j日志" class="headerlink" title="log4j日志"></a>log4j日志</h3><p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志模块的配置</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">ERROR, stdout</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印级别</span></span><br><span class="line"><span class="meta">log4j.logger.site.leric.mybatis</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="comment"># trace打印更多</span></span><br><span class="line"><span class="comment">#log4j.logger.site.leric.mybatis=TRACE</span></span><br><span class="line"><span class="comment"># 打印某个mapper 甚至单个方法的日志级别</span></span><br><span class="line"><span class="meta">log4j.logger.site.leric.mybatis.dao.VideoMapper.selectById</span>=<span class="string">TRACE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>



<h3 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h3><ol>
<li>Mybatis使⽤流程</li>
<li>创建mybatis-config.xml 全局的配置⽂件</li>
<li>创建XXXMapper.xml配置⽂件</li>
<li>创建SqlSessionFactory</li>
<li>⽤SqlSessionFactory创建SqlSession对象</li>
<li>⽤SqlSession执⾏增删改查CRUD</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 读取配置文件</span></span><br><span class="line">        String resources = <span class="string">&quot;config/mybatis-config.xml&quot;</span>;</span><br><span class="line">        <span class="comment">// 构建sessionFactory</span></span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resources);</span><br><span class="line">        SqlSessionFactory factory =  <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        <span class="comment">// 获取session</span></span><br><span class="line">        <span class="comment">// 使用try方法获取会自动关闭</span></span><br><span class="line">        <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">            VideoMapper mapper = session.getMapper(VideoMapper.class);</span><br><span class="line">            Video video = mapper.selectById(<span class="number">36</span>);</span><br><span class="line">            System.out.println(video.toString());</span><br><span class="line">            <span class="comment">// 使用注解</span></span><br><span class="line"><span class="comment">//            List&lt;Video&gt; videos = mapper.selectList();</span></span><br><span class="line"></span><br><span class="line">            List&lt;Video&gt; videos = mapper.selectListByXML();</span><br><span class="line">            <span class="keyword">for</span> (Video video1 : videos) &#123;</span><br><span class="line">                System.out.println(video1.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span></span></span><br><span class="line"><span class="tag">                          <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/springboot?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--  一个表会对应一个mapper，配置sql语句  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    注册mapper,被配置上的mapper会被自动扫描    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/VideoMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="映射器"><a href="#映射器" class="headerlink" title="映射器"></a>映射器</h3><p>一个映射器由接口与mapper配置文件组成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VideoMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据视频id查找对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 使用注解给参数取别名 取了别名就要用别名</span></span><br><span class="line">    <span class="function">Video <span class="title">selectById</span><span class="params">(<span class="meta">@Param(&quot;video_id&quot;)</span> <span class="keyword">int</span> videoId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找全部视频成列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;Select * from video&quot;)</span>  <span class="comment">// 使用注解实现sql绑定</span></span><br><span class="line">    <span class="function">List&lt;Video&gt; <span class="title">selectList</span><span class="params">()</span></span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<ul>
<li><p>namespace:名称空间，一般保持全局唯一，最好能与dao曾的java接口一致,将自动关联相关方法</p>
<p>可以映射相关的sql语句到对应的方法和参数、返回类型</p>
</li>
<li><p>id:当前mapper下唯一，且需要与接口方法一致方便封装</p>
</li>
<li><p>resultType：sql查询结果集的封装对象</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;site.leric.mybatis.dao.VideoMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line">        select * from video where id = #&#123;video_id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<p><strong>传参与入参</strong></p>
<ul>
<li><p>在接口的方法里使用@Param为参数指定别名</p>
</li>
<li><p>配置问文件SQL语句使用#{ } 或者 ${ } 引用参数</p>
</li>
<li><p>推荐使用#{ } ，因为${ } 实际上是拼接SQL命令，有面临QL注入的风险</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;site.leric.mybatis.dao.VideoMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line">        select * from video where id = #&#123;video_id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectListByXML&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line">        select * from video</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><h4 id="Select语句"><a href="#Select语句" class="headerlink" title="Select语句"></a>Select语句</h4><ol>
<li>根据id查询一条记录</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    参数类型并不需要过多的关注，MyBatis可以自动转化     --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    jdbcType 用于指定传入数据库的参数的转换类型，通常来说是需要手动指定，否则会出现无效类型错误      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select * from video where id = #&#123;videoid,jdbcType=INTEGER&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p>使用paramaterType指定自定义参数类型</p>
<p>在select语句中若传入自定义对象作为参数，需要取得封装类的字段作为参数，在sql语句中需要pojo.field</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    传参为自定义对象,入参时需要POJO.filed    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPointAndTitleLikeOnVideo&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select * from video where point = #&#123;video.point&#125; and title like concat(&#x27;%&#x27;,#&#123;video.title&#125;,&#x27;%&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li><p>模糊查询</p>
<p>模糊查询不能使用字符串拼接，需要使用自带函数concat(‘%’,paramater,‘%’)</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    模糊查询不能使用&#x27;%%&#x27; 字符串拼接的方式    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPointAndTitleLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select * from video where point = #&#123;point&#125; and title like concat(&#x27;%&#x27;,title,&#x27;%&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="4">
<li>sql片段复用</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;site.leric.mybatis.dao.VideoMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    定义sql片段     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_select&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line">        id,summary,title</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置了别名之后使用别名     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--    复用sql片段   --&gt;</span></span><br><span class="line">        select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_select&quot;</span>/&gt;</span> from video where id = #&#123;video_id&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="insert语句"><a href="#insert语句" class="headerlink" title="insert语句"></a>insert语句</h4><ol>
<li><p>插入一条数据并回填主键</p>
<p>插入数据若参数类型是自定义的自定义对象，则入参是只需要调用封装对象的属性名即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    插入记录</span></span><br><span class="line"><span class="comment">           useGeneratedKeys=&quot;true&quot;     主键回填</span></span><br><span class="line"><span class="comment">           keyProperty=&quot;id&quot;            映射Java对象属性</span></span><br><span class="line"><span class="comment">           keyColumn=&quot;id&quot;              映射数据库字段</span></span><br><span class="line"><span class="comment">           当参数非集合的时候,MyBatis能自动识别字段</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;add&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   INSERT INTO `springboot`.`video`(`title`, `summary`, `cover_img`, `price`, `create_time`, `point`)</span><br><span class="line">   VALUES</span><br><span class="line">   (#&#123;title,jdbcType=VARCHAR&#125;,#&#123;summary,jdbcType=VARCHAR&#125;,#&#123;coverImg,jdbcType=VARCHAR&#125;,</span><br><span class="line">   #&#123;price,jdbcType=INTEGER&#125;,#&#123;createTime,jdbcType=TIMESTAMP&#125;,#&#123;point,jdbcType=DOUBLE&#125;);</span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>





</li>
</ol>
<ol start="2">
<li><p>批量插入多条数据</p>
<p>参数类型是集合，在MyBatis中需要使用&lt;foreach&gt;标签进行迭代</p>
<p>并且在入参时，需要使用index.field 取得封装对象的属性</p>
</li>
</ol>
<h5 id="主键回填"><a href="#主键回填" class="headerlink" title="主键回填"></a>主键回填</h5><ul>
<li><p>useGeneratedKeys=”true”   开启主键回填</p>
</li>
<li><p>keyColumn=”id”  指定数据库中的主键列名</p>
</li>
<li><p>keyProperty=”id”  指定映射主键的field</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    批量插入</span></span><br><span class="line"><span class="comment">        item：每⼀个元素进⾏迭代时的别名</span></span><br><span class="line"><span class="comment">        index：索引的属性名，在集合数组情况下值为当前索引值，当迭代对象是map时，这个值是map的key</span></span><br><span class="line"><span class="comment">        open：整个循环内容的开头字符串</span></span><br><span class="line"><span class="comment">        close：整个循环内容的结尾字符串</span></span><br><span class="line"><span class="comment">        separator: 每次循环的分隔符</span></span><br><span class="line"><span class="comment">        当插入参数是集合时,需要使用item.field来指定参数</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    INSERT INTO `springboot`.`video`(`title`, `summary`, `cover_img`, `price`, `create_time`, `point`)</span><br><span class="line">    VALUES</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;video&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;video.title,jdbcType=VARCHAR&#125;,#&#123;video.summary,jdbcType=VARCHAR&#125;,#&#123;video.coverImg,jdbcType=VARCHAR&#125;,</span><br><span class="line">        #&#123;video.price,jdbcType=INTEGER&#125;,#&#123;video.createTime,jdbcType=TIMESTAMP&#125;,#&#123;video.point,jdbcType=DOUBLE&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="update语句"><a href="#update语句" class="headerlink" title="update语句"></a>update语句</h4><ol>
<li>更新一条记录</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateVideo&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;site.leric.mybatis.domain.Video&quot;</span>&gt;</span></span><br><span class="line">    UPDATE `springboot`.`video`</span><br><span class="line">    SET</span><br><span class="line">    `title` = #&#123;title,jdbcType = VARCHAR&#125;,</span><br><span class="line">    `summary` = #&#123;summary,jdbcType = VARCHAR&#125;,</span><br><span class="line">    `cover_img` = #&#123;coverImg,jdbcType = VARCHAR&#125;,</span><br><span class="line">    `price` = #&#123;price,jdbcType = INTEGER&#125;,</span><br><span class="line">    `create_time` = #&#123;createTime,jdbcType = TIMESTAMP&#125;,</span><br><span class="line">    `point` = #&#123;point,jdbcType = DOUBLE&#125;</span><br><span class="line">    WHERE `id` = #&#123;id,jdbcType = VARCHAR&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p>更新添加记录</p>
<p>trim用于判断字符串的开始与结尾且可以指定字符穿前缀以及去除最后一个字符的后缀</p>
<p>if 标签可以通过判断传⼊的值来确定查询条件，test 指定⼀个OGNL表达式</p>
<p>使用if标签，判断的时候需要依靠pojo的数据类型来判断条件，基本数据类型默认值与引用数据类型的默认是是不一样的</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        只有参数传入的字段不为空才进行更新操作</span></span><br><span class="line"><span class="comment">        trim 用于判断最后一个字符,加上指定的符号;</span></span><br><span class="line"><span class="comment">             并在第一个字符前加上前缀</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateVideoSelective&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br><span class="line">        UPDATE `springboot`.`video`</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;set&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title !=null&quot;</span>&gt;</span>`title` = #&#123;title,jdbcType = VARCHAR&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;summary !=null&quot;</span>&gt;</span>`summary` = #&#123;summary,jdbcType = VARCHAR&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;coverImg !=null&quot;</span>&gt;</span>`cover_img` = #&#123;coverImg,jdbcType = VARCHAR&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price !=0&quot;</span>&gt;</span>`price` = #&#123;price,jdbcType = INTEGER&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime !=null&quot;</span>&gt;</span>`create_time` = #&#123;createTime,jdbcType = TIMESTAMP&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 要以POJO的类型的默认值来决定条件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;point != 0.0&quot;</span>&gt;</span>`point` = #&#123;point,jdbcType = DOUBLE&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        WHERE `id` = #&#123;id,jdbcType = VARCHAR&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="delete语句"><a href="#delete语句" class="headerlink" title="delete语句"></a>delete语句</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    大于小于号需要转义字符     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByCreateTimeAndPrice&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.util.Map&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        delete from video where create_time &gt; #&#123;createTime&#125; and price &lt;![CDATA[ &lt; ]]&gt; #&#123;price&#125;</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="MyBatis转义"><a href="#MyBatis转义" class="headerlink" title="MyBatis转义"></a>MyBatis转义</h4><p>由于MyBatis的sql写在XML⾥⾯， 有些sql的语法符号和xml⾥⾯的冲突</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">⼤于等于 &lt;![CDATA[ &gt;&#x3D; ]]&gt;</span><br><span class="line">⼩于等于 &lt;![CDATA[ &lt;&#x3D; ]]&gt;</span><br></pre></td></tr></table></figure>



<h4 id="配置别名"><a href="#配置别名" class="headerlink" title="配置别名"></a>配置别名</h4><p>typeAlias 配置全局别名</p>
<ul>
<li>类型别名，给类取个别名，可以不⽤输⼊类的全限定名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--&lt;select id&#x3D;&quot;selectById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot;</span><br><span class="line">resultType&#x3D;&quot;net.xdclass.online_class.domain.Video&quot;&gt;--&gt;</span><br><span class="line"> &lt;select id&#x3D;&quot;selectById&quot; parameterType&#x3D;&quot;java.lang.Integer&quot;</span><br><span class="line">resultType&#x3D;&quot;Video&quot;&gt;</span><br><span class="line"> select * from video where id &#x3D; #&#123;video_id,jdbcType&#x3D;INTEGER&#125;</span><br><span class="line"> &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>​    别名配置之后使用全类名依然能正常使用</p>
<ul>
<li>包扫描配置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line"> &lt;!--&lt;typeAlias type=<span class="string">&quot;net.xdclass.online_class.domain.Video&quot;</span></span><br><span class="line">alias=<span class="string">&quot;Video&quot;</span>/&gt;--&gt;</span><br><span class="line">&lt;!--        指定domain包下的全部类都以类名作为别名--&gt;</span><br><span class="line"> &lt;<span class="keyword">package</span> name=<span class="string">&quot;net.xdclass.online_class.domain&quot;</span>/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="复杂查询"><a href="#复杂查询" class="headerlink" title="复杂查询"></a>复杂查询</h3><p>Mybatis的SQL语句返回结果有两种</p>
<ul>
<li>resultType<ul>
<li>查询出的字段在相应的pojo中必须有和它相同的字段对应(列名精准匹配)，或者基本数据类型</li>
<li>适合简单查询</li>
<li>实际上Mybatis在后台创建了一个ResultMap</li>
</ul>
</li>
<li>resultMap</li>
<li>从查询出来的结果中映射到对象，定义映射规则<ul>
<li>需要⾃定义字段，或者多表查询，⼀对多等关系，⽐resultType更强⼤</li>
<li>适合复杂查询</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--根据sql查询结果自动映射到指定的实体类里面--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;VideoResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Video&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        id:映射主键</span></span><br><span class="line"><span class="comment">        colunm 对应数据库的列</span></span><br><span class="line"><span class="comment">        property 映射到POJO类属性的名称</span></span><br><span class="line"><span class="comment">        jdbcType 数据库参数类型</span></span><br><span class="line"><span class="comment">        从查询结果中按照colonm与实体类的property完成映射</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;summary&quot;</span> <span class="attr">property</span>=<span class="string">&quot;summary&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cover_img&quot;</span> <span class="attr">property</span>=<span class="string">&quot;coverImg&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="一对一查询association"><a href="#一对一查询association" class="headerlink" title="一对一查询association"></a>一对一查询association</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;VideoOrderResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;VideoOrder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;out_trade_no&quot;</span> <span class="attr">property</span>=<span class="string">&quot;outTradeNo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total_fee&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalFee&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoTitle&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        关联User对象，一对一关联</span></span><br><span class="line"><span class="comment">        association 配置一对一映射</span></span><br><span class="line"><span class="comment">        property  对应VideoOrder里面的user属性名</span></span><br><span class="line"><span class="comment">        javaType  这个属性的类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;head_img&quot;</span> <span class="attr">property</span>=<span class="string">&quot;headImg&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="一对多查询collection"><a href="#一对多查询collection" class="headerlink" title="一对多查询collection"></a>一对多查询collection</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserOrderResultMapper&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;head_img&quot;</span> <span class="attr">property</span>=<span class="string">&quot;headImg&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;phone&quot;</span> <span class="attr">property</span>=<span class="string">&quot;phone&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment">&lt;!--    关联orderList对象 一对多关联</span></span><br><span class="line"><span class="comment">        collection 配置一对多映射</span></span><br><span class="line"><span class="comment">        property  对应VideoOrder里面的user属性名</span></span><br><span class="line"><span class="comment">        ofType  集合类成员的类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;videoOrder&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;VideoOrder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;order_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;out_trade_no&quot;</span> <span class="attr">property</span>=<span class="string">&quot;outTradeNo&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;order_create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total_fee&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalFee&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoId&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoTitle&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="缓存与懒加载"><a href="#缓存与懒加载" class="headerlink" title="缓存与懒加载"></a>缓存与懒加载</h3><h4 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h4><p>程序经常要调⽤的对象存在内存中,⽅便其使⽤时可以快速调⽤,不必去数据库或者其他持久化设备中查询，主要就是提⾼性能</p>
<ul>
<li>Mybatis⼀级缓存<ul>
<li>简介：⼀级缓存的作⽤域是SQLSession，session关闭之后缓存失效</li>
<li>同⼀个SqlSession中执⾏相同的SQL查询(相同的SQL和参数)，第⼀次会去查询数据库并写在缓存中，第⼆次会直接从缓存中取</li>
<li>基于PerpetualCache 的 HashMap本地缓存</li>
<li>默认开启⼀级缓存</li>
</ul>
</li>
<li>失效策略：当执⾏SQL时候两次查询中间发⽣了增删改的操作，即insert、update、delete等操作<strong>commit后会清空该SQLSession缓存</strong>; <strong>⽐如sqlsession关闭，或者清空</strong>等</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 演示一级缓存</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">    Video video = mapper.selectBseFieldByIdWithResultMap(<span class="number">36</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(video.toString());</span><br><span class="line">&#125;</span><br><span class="line">==============只发送了一次sql==============</span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: SELECT id , title AS video_title,summary,cover_img from video where id = ? </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: <span class="number">36</span>(Integer)</span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">1</span></span><br><span class="line">Video&#123;id=<span class="number">36</span>, title=<span class="string">&#x27;19年录制ES6教程ES7ES8实战应用&#x27;</span>, summary=<span class="string">&#x27;https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/video/2019_frontend/es67/es67_detail.png</span></span><br><span class="line"><span class="string">&#x27;</span>, CoverImg=<span class="string">&#x27;https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/video/2019_frontend/es67/es.png</span></span><br><span class="line"><span class="string">&#x27;</span>, price=<span class="number">0</span>, creteTime=<span class="keyword">null</span>, point=<span class="number">0.0</span>&#125;</span><br><span class="line">Video&#123;id=<span class="number">36</span>, title=<span class="string">&#x27;19年录制ES6教程ES7ES8实战应用&#x27;</span>, summary=<span class="string">&#x27;https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/video/2019_frontend/es67/es67_detail.png</span></span><br><span class="line"><span class="string">&#x27;</span>, CoverImg=<span class="string">&#x27;https://xd-video-pc-img.oss-cn-beijing.aliyuncs.com/xdclass_pro/video/2019_frontend/es67/es.png</span></span><br><span class="line"><span class="string">&#x27;</span>, price=<span class="number">0</span>, creteTime=<span class="keyword">null</span>, point=<span class="number">0.0</span>&#125;</span><br></pre></td></tr></table></figure>



<h4 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h4><ul>
<li><p>简介：⼆级缓存是namespace级别的，多个SqlSession去操作同⼀个namespace下的Mapper的sql语句，多个SqlSession可以共⽤</p>
<p>⼆级缓存,如果两个mapper的namespace相同，</p>
<p>(即使是两个mapper，那么这两个mapper中执⾏sql查询到的数据也将存在相同的⼆级缓存区域中，但是建议是每个Mapper单独的名称空间）</p>
</li>
<li><p>基于PerpetualCache 的 HashMap本地缓存，可⾃定义存储源，如 Ehcache/Redis等</p>
</li>
<li><p>默认是没有开启⼆级缓存</p>
</li>
<li><p>操作流程：第⼀次调⽤某个namespace下的SQL去查询信息，查询到的信息会存放该mapper对应的⼆级缓存区域。 </p>
<p>第⼆次调⽤同个namespace下的mapper映射⽂件中，<strong>相同的sql去查询信息</strong>，会去对应的⼆级缓存内取结果</p>
</li>
<li><p>失效策略：执⾏同个namespace下的mapepr映射⽂件中增删改sql，并执⾏了commit操作,会清空该⼆级缓存</p>
</li>
<li><p>注意：实现⼆级缓存的时候，MyBatis建议返回的POJO是可序列化的， 也就是建议<strong>实现Serializable接⼝</strong></p>
<p>使用自定义存储源头必须实现序列化接口</p>
</li>
<li><p>缓存淘汰策略：会使⽤默认的 LRU 算法来收回（最近最少使⽤的）</p>
</li>
<li><p>如何开启某个⼆级缓存 mapper.xml⾥⾯配置</p>
</li>
</ul>
<p>mapper配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启mapper的namespace下的⼆级缓存--&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> eviction:代表的是缓存回收策略，常⻅下⾯两种。</span></span><br><span class="line"><span class="comment"> (1) LRU,最近最少使⽤的，⼀处最⻓时间不⽤的对象</span></span><br><span class="line"><span class="comment"> (2) FIFO,先进先出，按对象进⼊缓存的顺序来移除他们</span></span><br><span class="line"><span class="comment"> flushInterval:刷新间隔时间，单位为毫秒，这⾥配置的是100秒刷新，如果不配置</span></span><br><span class="line"><span class="comment">它，当SQL被执⾏的时候才会去刷新缓存。</span></span><br><span class="line"><span class="comment"> size:引⽤数⽬，代表缓存最多可以存储多少个对象，设置过⼤会导致内存溢出</span></span><br><span class="line"><span class="comment"> readOnly:只读，缓存数据只能读取⽽不能修改，默认值是false</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;LRU&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;100000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;true&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>全局配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 全局配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个配置使全局的映射器(⼆级缓存)启⽤或禁⽤缓存，全局总开关，这⾥关闭，mapper中开启</span></span><br><span class="line"><span class="comment">了也没⽤--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="二级缓存演示"><a href="#二级缓存演示" class="headerlink" title="二级缓存演示"></a><strong>二级缓存演示</strong></h4><p>演示代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = factory.openSession();</span><br><span class="line"></span><br><span class="line">VideoOrderMapper mapper1 = session.getMapper(VideoOrderMapper.class);</span><br><span class="line">List&lt;VideoOrder&gt; videoOrders = mapper1.queryVideoOrderList();</span><br><span class="line">System.out.println(videoOrders.size());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交清空一级缓存</span></span><br><span class="line">session.commit();</span><br><span class="line"></span><br><span class="line">VideoOrderMapper mapper2 = session.getMapper(VideoOrderMapper.class);</span><br><span class="line">List&lt;VideoOrder&gt; videoOrders2 = mapper2.queryVideoOrderList();</span><br><span class="line">System.out.println(videoOrders2.size());</span><br></pre></td></tr></table></figure>



<p>在没有开启二级缓存的情况下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title, u.name,u.head_img,u.create_time,u.phone from video_order as o left join user as u on o.user_id = u.id </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title, u.name,u.head_img,u.create_time,u.phone from video_order as o left join user as u on o.user_id = u.id </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">==============发送了两次sql==============</span><br></pre></td></tr></table></figure>



<p>开启了二级缓存后</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - Cache Hit Ratio [site.leric.mybatis.dao.VideoOrderMapper]: <span class="number">0.0</span></span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title, u.name,u.head_img,u.create_time,u.phone from video_order as o left join user as u on o.user_id = u.id </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">DEBUG [main] - Cache Hit Ratio [site.leric.mybatis.dao.VideoOrderMapper]: <span class="number">0.5</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">==============只发送一次sql==============</span><br></pre></td></tr></table></figure>



<p>在关闭二级请求，并且清理一级缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">VideoOrderMapper mapper1 = session.getMapper(VideoOrderMapper.class);</span><br><span class="line">List&lt;VideoOrder&gt; videoOrders = mapper1.queryVideoOrderList();</span><br><span class="line">System.out.println(videoOrders.size());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交清空一级缓存</span></span><br><span class="line">session.commit();</span><br><span class="line"></span><br><span class="line">List&lt;VideoOrder&gt; videoOrders2 = mapper1.queryVideoOrderList();</span><br><span class="line">System.out.println(videoOrders2.size());</span><br></pre></td></tr></table></figure>

<p><strong>优先查询二级缓存==&gt;一级缓存==&gt;数据库</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title, u.name,u.head_img,u.create_time,u.phone from video_order as o left join user as u on o.user_id = u.id </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title, u.name,u.head_img,u.create_time,u.phone from video_order as o left join user as u on o.user_id = u.id </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">6</span></span><br><span class="line"><span class="number">6</span></span><br><span class="line">==============发送了两次sql==============</span><br></pre></td></tr></table></figure>



<p>控制方法是否使用二级缓存</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--useCache是否使用二级缓存--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryVideoOrderList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;VideoOrderResultMap&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        select o.id,o.user_id,o.create_time,o.state,o.total_fee,o.video_id,o.video_title,</span><br><span class="line">               u.name,u.head_img,u.create_time,u.phone</span><br><span class="line">        from video_order as o left join user as u on o.user_id = u.id</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h4><ul>
<li><p>什么是懒加载： <strong>按需加载</strong>，先从单表查询，需要时再从关联表去关联查询，能⼤⼤提⾼数据库性能,并不是所有场景下使⽤懒加载都能提⾼效率</p>
</li>
<li><p>Mybatis懒加载： resultMap⾥⾯的<strong>association、collection有延迟加载功能</strong></p>
</li>
<li><p>开启懒加载</p>
<ul>
<li>全局配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--全局参数设置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--延迟加载总开关--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--将aggressiveLazyLoading设置为false表示按需加载，默认为true--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Mapperp配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;VideoOrderResultMapLazy&quot;</span> <span class="attr">type</span>=<span class="string">&quot;VideoOrder&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;out_trade_no&quot;</span> <span class="attr">property</span>=<span class="string">&quot;outTradeNo&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;state&quot;</span> <span class="attr">property</span>=<span class="string">&quot;state&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total_fee&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalFee&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoId&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_title&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoTitle&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;video_img&quot;</span> <span class="attr">property</span>=<span class="string">&quot;videoImg&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">select： 指定延迟加载需要执⾏的statement id</span></span><br><span class="line"><span class="comment">column： 和select查询关联的字段</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;User&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">select</span>=<span class="string">&quot;findUserByUserId&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--⼀对⼀管理查询订单， 订单内部包含⽤户属性</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">懒加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;queryVideoOrderListLazy&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;VideoOrderResultMapLazy&quot;</span>&gt;</span></span><br><span class="line"> select</span><br><span class="line"> o.id id,o.user_id ,o.out_trade_no,o.create_time,o.state,o.total_fee,o.video_id,o.video_title,o.video_img</span><br><span class="line"> from video_order o</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line"> select * from user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="数据库事务"><a href="#数据库事务" class="headerlink" title="数据库事务"></a>数据库事务</h3><ul>
<li><p>使⽤JDBC的事务管理<br>使⽤ java.sql.Connection对象完成对事务的提交（commit()）、回滚（rollback()）、关闭（close()）</p>
</li>
<li><p>使⽤MANAGED的事务管理<br>MyBatis⾃身不会去实现事务管理，⽽让程序的容器如（Spring, JBOSS）来实现对事务的管理</p>
<p><strong>使用MANAGED一般不设置自动提交</strong></p>
</li>
<li><p>Mybatis事务⼯⼚TransactionFactory 的两个实现类，对应两种事务管理方式</p>
<ul>
<li>JdbcTransactionFactory-&gt;JdbcTransaction</li>
<li>ManagedTransactionFactory-&gt;ManagedTransaction</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"> <span class="comment">&lt;!-- mybatis使⽤jdbc事务管理⽅式 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line"> <span class="comment">&lt;!-- mybatis使⽤MANAGED事务管理⽅式（使用外部的管理方式） --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"> <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/xdclass?</span></span></span><br><span class="line"><span class="tag"><span class="string">useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>useSSL=false&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;xdclass.net&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>两种数据库引擎</p>
<table>
<thead>
<tr>
<th>区别项</th>
<th>Innodb</th>
<th>myisam</th>
</tr>
</thead>
<tbody><tr>
<td>事务</td>
<td>⽀持</td>
<td>不⽀持</td>
</tr>
<tr>
<td>锁粒度</td>
<td>⾏锁，适合⾼并发</td>
<td>表锁，不适合⾼并发</td>
</tr>
<tr>
<td>是否默认</td>
<td>默认</td>
<td>⾮默认</td>
</tr>
<tr>
<td>⽀持外键</td>
<td>⽀持外键</td>
<td>不⽀持</td>
</tr>
<tr>
<td>适合场景</td>
<td>读写均衡,写⼤于读场景，需要事务</td>
<td>读多写少场景，不需要事务</td>
</tr>
<tr>
<td>全⽂索引</td>
<td>可以通过插件实现, 更多使⽤ElasticSearch</td>
<td>⽀持全⽂索引</td>
</tr>
</tbody></table>
<p><strong>MyISAM不⽀持事务，如果需要事务则改为innodb引擎 更改数据库的表⾥⾯的引擎</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置事务自动提交</span></span><br><span class="line">SqlSession session = factory.openSession(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Leric</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lyric-git.gitee.io/Lyric-git/2020/08/15/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://lyric-git.gitee.io/Lyric-git/2020/08/15/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lyric-git.gitee.io/Lyric-git" target="_blank">Leric</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/Lyric-git/tags/MyBatis/">MyBatis</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/08/21/dtaViR.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/Lyric-git/2020/08/19/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev-cover" data-lazy-src="https://s1.ax1x.com/2020/08/21/dtaViR.jpg" onerror="onerror=null;src='/Lyric-git/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/Lyric-git/2020/07/18/SSM%E5%B8%B8%E8%A7%81%E6%B3%A8%E8%A7%A3/"><img class="next-cover" data-lazy-src="https://s1.ax1x.com/2020/08/21/dtaViR.jpg" onerror="onerror=null;src='/Lyric-git/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring boot、Spring 常用注解</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/Lyric-git/2020/07/18/SSM常见注解/" title="Spring boot、Spring 常用注解"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/21/dtaViR.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">Spring boot、Spring 常用注解</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Leric</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/Lyric-git/js/utils.js"></script><script src="/Lyric-git/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="false" src="/Lyric-git/js/third-party/piao.js"></script></div><script src="/Lyric-git/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"/Lyric-git/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>