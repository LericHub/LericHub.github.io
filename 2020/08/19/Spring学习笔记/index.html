<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring学习笔记 | Leric</title><meta name="description" content="IOC&#x2F;AOP IOC 管理创建和组装对象之间的依赖关系  使⽤前：⼿⼯创建 使⽤后：Spring创建，⾃动注⼊ 核⼼：把创建对象的控制权反转给Spring框架，对象的⽣命周期由Spring统⼀管理   AOP ⾯向切⾯编程（AOP）可以解耦核⼼业务和边缘业务的关系 场景：⽤户调⽤下单购买视频接⼝，需要判断登录，拦截器是AOP思想的⼀种实现 使⽤前：代码写逻辑，每次下单都调⽤⽅法判断，多个⽅法需要"><meta name="keywords" content="Spring"><meta name="author" content="Leric"><meta name="copyright" content="Leric"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://s1.ax1x.com/2020/08/21/dteT7F.png"><link rel="canonical" href="http://lyric-git.gitee.io/leric-blog/2020/08/19/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Spring学习笔记"><meta property="og:url" content="http://lyric-git.gitee.io/leric-blog/2020/08/19/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="Leric"><meta property="og:description" content="IOC&#x2F;AOP IOC 管理创建和组装对象之间的依赖关系  使⽤前：⼿⼯创建 使⽤后：Spring创建，⾃动注⼊ 核⼼：把创建对象的控制权反转给Spring框架，对象的⽣命周期由Spring统⼀管理   AOP ⾯向切⾯编程（AOP）可以解耦核⼼业务和边缘业务的关系 场景：⽤户调⽤下单购买视频接⼝，需要判断登录，拦截器是AOP思想的⼀种实现 使⽤前：代码写逻辑，每次下单都调⽤⽅法判断，多个⽅法需要"><meta property="og:image" content="https://s1.ax1x.com/2020/08/21/dtaViR.jpg"><meta property="article:published_time" content="2020-08-19T07:33:06.000Z"><meta property="article:modified_time" content="2020-08-21T07:34:51.967Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="./css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: './',
  hexoversion: '5.0.2',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-08-21 15:34:51'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.0.2"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://s1.ax1x.com/2020/08/21/dYbiKf.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="./archives/"><div class="headline">文章</div><div class="length_num">3</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="./tags/"><div class="headline">标签</div><div class="length_num">2</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="./categories/"><div class="headline">分类</div><div class="length_num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="./"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="./archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="./categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="./link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="./about/"><i class="fa-fw fas fa-user"></i><span> 我</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IOC-AOP"><span class="toc-number">1.</span> <span class="toc-text">IOC&#x2F;AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.2.</span> <span class="toc-text">bean的作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">三种注入方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setter%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.1.</span> <span class="toc-text">setter注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5"><span class="toc-number">1.3.2.</span> <span class="toc-text">构造器注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POJO%E7%B1%BB%E5%9E%8B%E6%B3%A8%E2%BC%8A"><span class="toc-number">1.3.3.</span> <span class="toc-text">POJO类型注⼊</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#List%E4%B8%8EMap%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-number">1.4.</span> <span class="toc-text">List与Map的注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringIOC%E5%86%85bean%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-number">1.5.</span> <span class="toc-text">SpringIOC内bean的继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E9%94%80%E6%AF%81"><span class="toc-number">1.6.</span> <span class="toc-text">生命周期：初始化与销毁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86%E5%99%A8BeanPostProessor"><span class="toc-number">1.7.</span> <span class="toc-text">后置处理器BeanPostProessor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8autoWired%E5%B1%9E%E6%80%A7%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5"><span class="toc-number">1.8.</span> <span class="toc-text">使用autoWired属性实现自动注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP"><span class="toc-number">2.</span> <span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Advide%E7%9A%84%E4%BA%94%E7%A7%8D%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">Advide的五种类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">2.3.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.4.</span> <span class="toc-text">切入点表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E5%AE%9E%E6%88%98"><span class="toc-number">2.6.</span> <span class="toc-text">AOP实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AESpring"><span class="toc-number">2.7.</span> <span class="toc-text">使用注解配置Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E9%85%8D%E7%BD%AE%E5%92%8C%E5%8C%85%E6%89%AB%E6%8F%8F"><span class="toc-number">2.7.1.</span> <span class="toc-text">开启配置和包扫描</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%B2%E8%A7%A3spring%E7%9A%84xml%E5%92%8C%E6%B3%A8%E8%A7%A3%E5%AF%B9%E2%BD%90"><span class="toc-number">2.7.2.</span> <span class="toc-text">讲解spring的xml和注解对⽐</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B1%BB%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.8.</span> <span class="toc-text">管理第三方类的注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84property%E6%96%87%E4%BB%B6"><span class="toc-number">2.9.</span> <span class="toc-text">自动映射property文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E7%9A%84%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">2.10.</span> <span class="toc-text">AOP的注解配置方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5"><span class="toc-number">2.11.</span> <span class="toc-text">环绕通知</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-number">2.12.</span> <span class="toc-text">事务传播行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">2.13.</span> <span class="toc-text">事务隔离级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88SpringBoot%E4%B8%8EMyBatis"><span class="toc-number">3.</span> <span class="toc-text">Spring整合SpringBoot与MyBatis</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/08/21/dtaViR.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="./">Leric</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="./"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="./archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="./categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="./link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="./about/"><i class="fa-fw fas fa-user"></i><span> 我</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Spring学习笔记</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-08-19T07:33:06.000Z" title="发表于 2020-08-19 15:33:06">2020-08-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-08-21T07:34:51.967Z" title="更新于 2020-08-21 15:34:51">2020-08-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="./categories/code/">code</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="./categories/code/Java/">Java</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="IOC-AOP"><a href="#IOC-AOP" class="headerlink" title="IOC/AOP"></a>IOC/AOP</h2><ul>
<li>IOC<ul>
<li>管理创建和组装对象之间的依赖关系 </li>
<li>使⽤前：⼿⼯创建</li>
<li>使⽤后：Spring创建，⾃动注⼊</li>
<li>核⼼：把创建对象的控制权反转给Spring框架，对象的⽣命周期由Spring统⼀管理</li>
</ul>
</li>
<li>AOP<ul>
<li>⾯向切⾯编程（AOP）可以解耦核⼼业务和边缘业务的关系</li>
<li>场景：⽤户调⽤下单购买视频接⼝，需要判断登录，拦截器是AOP思想的⼀种实现</li>
<li>使⽤前：代码写逻辑，每次下单都调⽤⽅法判断，多个⽅法需要判断登录则都需要 登录⽅法判断</li>
<li>使⽤后：根据⼀定的⽅法或者路径规则进⾏判断是否要调⽤，降低代码耦合度</li>
</ul>
</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><strong>命名空间</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string"> https://www.springframework.org/schema/beans/spring￾beans.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>beans</strong></p>
<p>用于配置bean，注册将来会注入的对象到Spring IOC容器中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    bean标签 id属性：指定Bean的名称，在Bean被别的类依赖时使⽤</span></span><br><span class="line"><span class="comment">    name属性：⽤于指定Bean的别名，如果没有id，也可以⽤name</span></span><br><span class="line"><span class="comment">    class属性：⽤于指定Bean的来源，要创建的Bean的class类，需要全限定名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        </span></span><br><span class="line"><span class="comment">            name 指定要注入的属姓名</span></span><br><span class="line"><span class="comment">            value 注入值</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;9&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Spring 5.x&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>依赖注入</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;VideoOrder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.VideoOrder&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;outTradeNo&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1454265hjnlkj&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        video属性 依赖于 video</span></span><br><span class="line"><span class="comment">        ref 将id为video的bean 注入到VideoOrder中的video属性中</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;video&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;Video&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="bean的作用域"><a href="#bean的作用域" class="headerlink" title="bean的作用域"></a>bean的作用域</h3><ul>
<li>scope属性<ul>
<li>singleton：单例, 默认值，调⽤getBean⽅法返回是同⼀个对象,实例会被缓存起来，效率⽐较⾼ 当⼀个bean被标识为singleton时候，spring的IOC容器中只会存在⼀个该bean</li>
<li>prototype: 多例，调⽤getBean⽅法创建不同的对象，会频繁的创建和销毁对象造成很⼤的<br>开销</li>
<li>其他少⽤ （作⽤域 只在 WebApplicationContext (web环境下)）<ul>
<li>request ：每个Http请求都会创建⼀个新的bean</li>
<li>session: 每个Http Session请求都会创建⼀个新的bean</li>
<li>global session（基本不⽤）</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用scope属性指定作用域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;9&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Spring 5.x&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="三种注入方式"><a href="#三种注入方式" class="headerlink" title="三种注入方式"></a>三种注入方式</h3><h4 id="setter注入"><a href="#setter注入" class="headerlink" title="setter注入"></a>setter注入</h4><p>会调用POJO的setter方法进行注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;video&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.xdclass.sp.domain.Video&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;9&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Spring 5.X课程&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>若bean里面有<strong>依赖</strong>的话也是通过<strong>setter方法</strong>进行注入</p>
<h4 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h4><p>会调用POJO的构造函数进行注入。</p>
<p>注意：要定义带参数构造函数，且类的构造函数重写的时候，⼀定要保留空构造函数以保证其他注入方法正常运行</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;VideoConstructor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;constructor-arg name=&quot;title&quot; value=&quot;测试&quot;/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用索引注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;测试&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="POJO类型注⼊"><a href="#POJO类型注⼊" class="headerlink" title="POJO类型注⼊"></a><strong>POJO类型注⼊</strong></h4><p>property 没有使⽤value属性，⽽是使⽤了ref属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;VideoOrder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.VideoOrder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;outTradeNo&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1454265hjnlkj&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--POJO注入--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;video&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;Video&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="List与Map的注入"><a href="#List与Map的注入" class="headerlink" title="List与Map的注入"></a>List与Map的注入</h3><p>注入list类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注入list类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;chapterList&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>第一章<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>第二章<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>第三章<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注入map类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--注入list类型--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;videoMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;第一节&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;第二节&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;3&quot;</span> <span class="attr">value</span>=<span class="string">&quot;第三节&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="SpringIOC内bean的继承"><a href="#SpringIOC内bean的继承" class="headerlink" title="SpringIOC内bean的继承"></a>SpringIOC内bean的继承</h3><ul>
<li><p>bean继承：两个类之间⼤多数的属性都相同，避免重复配置，<strong>通过bean标签的parent属性重⽤已有的Bean元素的配置信息</strong> </p>
<p>继承指的是配置信息的复⽤，<strong>和Java类的继承没有关系</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  使用parent属性指定bean继承video1，video2公用部分  --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video2&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Video&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;summary&quot;</span> <span class="attr">value</span>=<span class="string">&quot;简介&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>属性依赖: 如果类A是作为类B的属性, 想要类A⽐类B先实例化，设置两个Bean的依赖关系</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  指定Video先于VideoOrder实例化  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;VideoOrder&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.VideoOrder&quot;</span> <span class="attr">depends-on</span>=<span class="string">&quot;Video&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;outTradeNo&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1454265hjnlkj&quot;</span>/</span></span><br><span class="line">    &lt;!--</span><br><span class="line">    video属性 依赖于 video</span><br><span class="line">    ref 将id为video的bean 注入到VideoOrder中的video属性中</span><br><span class="line">    --&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;video&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;Video&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="生命周期：初始化与销毁"><a href="#生命周期：初始化与销毁" class="headerlink" title="生命周期：初始化与销毁"></a>生命周期：初始化与销毁</h3><p>在POJO自定义初始化与销毁方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Video被初始化&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 销毁方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">destroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Video被销毁&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在配置文件对应的bean中配置初始化方法与销毁方法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">==============================</span><br><span class="line">Video3 空参构造</span><br><span class="line">Video被初始化</span><br><span class="line">Video被销毁</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="后置处理器BeanPostProessor"><a href="#后置处理器BeanPostProessor" class="headerlink" title="后置处理器BeanPostProessor"></a>后置处理器BeanPostProessor</h3><ul>
<li><p>什么是BeanPostProcessor</p>
<ul>
<li>是Spring IOC容器给我们提供的⼀个扩展接⼝，实现了规定接口的bean成为后置处理器，实现bean初始化前后的一些处理</li>
<li>在调⽤初始化⽅法前后对 Bean 进⾏额外加⼯，ApplicationContext 会⾃动扫描实现了BeanPostProcessor的 bean，并注册这些 bean 为后置处理器</li>
<li>是Bean的统⼀前置后置处理⽽不是基于某⼀个bean</li>
<li>注意：接⼝重写的两个⽅法不能返回null，如果返回null那么在后续初始化⽅法将报空指针异常或者通过getBean()⽅法获取不到bean实例对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span>, <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CustomerBeanPostProcessor1 postProcessBeforeInitialization beanName&quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CustomerBeanPostProcessor1 postProcessAfterInitialization beanName&quot;</span> + beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">===============配置文件注册处理器===============</span><br><span class="line">&lt;!-- 注册BeanPostProcessor --&gt;</span><br><span class="line">&lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;site.leric.processor.CustomBeanPostProcessor&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行顺序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring IOC容器实例化Bean</span><br><span class="line">调⽤BeanPostProcessor的postProcessBeforeInitialization⽅法</span><br><span class="line">调⽤bean实例的初始化⽅法</span><br><span class="line">调⽤BeanPostProcessor的postProcessAfterInitialization⽅法</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以注册多个BeanPostProcessor顺序</p>
<ul>
<li>在Spring机制中可以指定后置处理器调⽤顺序，通过BeanPostProcessor接⼝实现类实现Ordered接⼝getOrder⽅法，该⽅法返回整数，<strong>默认值为 0优先级最⾼，值越⼤优先级越低</strong></li>
</ul>
</li>
</ul>
<h3 id="使用autoWired属性实现自动注入"><a href="#使用autoWired属性实现自动注入" class="headerlink" title="使用autoWired属性实现自动注入"></a>使用autoWired属性实现自动注入</h3><ul>
<li><p>属性注⼊</p>
<ul>
<li>前⾯学过属性注⼊，set⽅法、构造函数等，属于⼿⼯注⼊</li>
</ul>
</li>
<li><p>有没办法实现⾃动装配注⼊？</p>
</li>
<li><p>Spring⾃动注⼊</p>
<ul>
<li><p>使⽤元素的 autowire 属性为⼀个 bean 定义指定⾃动装配模式</p>
</li>
<li><p>autowire设置值</p>
<ul>
<li><p>no：没开启</p>
</li>
<li><p>byName: 根据bean的id名称，注⼊到对应的属性⾥⾯</p>
</li>
<li><p>byType：根据bean需要注⼊的类型，注⼊到对应的属性⾥⾯</p>
<ul>
<li><p>如果按照类型注⼊，存在2个以上bean的话会抛异常</p>
</li>
<li><pre><code class="java">No qualifying bean of type &#39;site.leric.domain.Video3&#39; available: expected single matching bean but found 2: video,video2
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - constructor: 通过构造函数注⼊，**需要这个类型的构造函数**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#96;&amp;#96;&amp;#96;xml&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;bean id&amp;#x3D;&amp;quot;video&amp;quot; class&amp;#x3D;&amp;quot;site.leric.domain.Video3&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;property name&amp;#x3D;&amp;quot;id&amp;quot; value&amp;#x3D;&amp;quot;5&amp;quot;&amp;#x2F;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;property name&amp;#x3D;&amp;quot;title&amp;quot; value&amp;#x3D;&amp;quot;autowired&amp;quot;&amp;#x2F;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&amp;#x2F;bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;!--用autowire取代ref引入--&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;bean id&amp;#x3D;&amp;quot;VideoOrder2&amp;quot; class&amp;#x3D;&amp;quot;site.leric.domain.VideoOrder3&amp;quot; autowire&amp;#x3D;&amp;quot;byName&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;property name&amp;#x3D;&amp;quot;id&amp;quot; value&amp;#x3D;&amp;quot;8&amp;quot;&amp;#x2F;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;lt;property name&amp;#x3D;&amp;quot;outTradeNo&amp;quot; value&amp;#x3D;&amp;quot;1454265hjnlkj&amp;quot;&amp;#x2F;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;&amp;#x2F;bean&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被注入的类型的构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">VideoOrder3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;VideoOrder空参数构造函数被调用&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><ul>
<li><p>什么是AOP</p>
<ul>
<li>Aspect Oriented Program ⾯向切⾯编程</li>
</ul>
</li>
<li><p>在到达目标业务代码之前先对对象进行处理</p>
<ul>
<li>在不改变原有逻辑上增加额外的功能，⽐如解决系统层⾯的问题，或者增加新的功能</li>
</ul>
</li>
<li><p>场景</p>
<ul>
<li>权限控制</li>
<li>缓存 </li>
<li>⽇志处理</li>
<li>事务控制</li>
</ul>
</li>
<li><p>AOP思想把功能分两个部分，分离系统中的各种关注点</p>
<ul>
<li>核⼼关注点<ul>
<li>业务的主要功能</li>
</ul>
</li>
<li>横切关注点<ul>
<li>⾮核⼼、额外增加的功能</li>
</ul>
</li>
</ul>
</li>
<li><p>好处</p>
<ul>
<li>减少代码侵⼊，解耦</li>
<li>可以统⼀处理横切逻辑</li>
<li>⽅便添加和删除横切逻辑</li>
</ul>
</li>
</ul>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><p><img src= "./img/loading.gif" data-lazy-src="D:\java\SpringBoot\项目\RESOURCES\image-20200812203405280.png" alt="image-20200812203405280"></p>
<ul>
<li><p>横切关注点(非核心功能)</p>
</li>
<li><p>对哪些⽅法进⾏<strong>拦截，拦截后怎么处理</strong>，这些就叫横切关注点⽐如 权限认证、⽇志、事物</p>
</li>
<li><p>通知 Advice</p>
</li>
<li><p>在特定的切⼊点上执⾏的<strong>增强处理</strong>，有5种通知，后⾯讲解做啥？ ⽐如你需要记录⽇志，控制事务 ，提前编写好通⽤的模块，需要的地⽅直接调⽤</p>
</li>
<li><p>连接点 JointPoint</p>
</li>
<li><p>要⽤<strong>通知的地⽅</strong>，业务流程在运⾏过程中<strong>需要插⼊切⾯的具体位置</strong>，⼀般是⽅法的调⽤前后，全部⽅法都可以是连接点</p>
</li>
<li><p>只是概念，没啥特殊</p>
</li>
<li><p>切⼊点 Pointcut</p>
<ul>
<li><p>不能全部⽅法都是连接点，<strong>通过特定的规则来筛选连接点</strong>, 就是Pointcut，选中那⼏个你想要的⽅法</p>
</li>
<li><p>在程序中主要体现为书写<strong>切⼊点表达式</strong>（通过通配、正则表达式）过滤出特定的<strong>⼀组</strong>JointPoint连接点</p>
</li>
<li><p>过滤出相应的 Advice 将要发⽣的joinpoint</p>
</li>
</ul>
</li>
<li><p>切⾯ Aspect</p>
<ul>
<li><p>通常是⼀个类，<strong>⾥⾯定义切⼊点+通知</strong> , 定义在什么地⽅;什么时间点、做什么事情</p>
</li>
<li><p>通知advice指明了时间和做的事情（前置、后置等）</p>
</li>
<li><p>切⼊点 pointcut 指定在什么地⽅⼲这个事情</p>
</li>
<li><p>web接⼝设计中，web层-&gt;⽹关层-&gt;服务层-&gt;数据层，每⼀层之间也是⼀个切⾯，对象和对象，⽅法和⽅法之间都是⼀个个切⾯</p>
</li>
</ul>
</li>
<li><p>⽬标 target</p>
<ul>
<li>⽬标类，<strong>真正的业务逻辑</strong>，可以在⽬标类不知情的条件下，增加新的功能到⽬标类的链路上</li>
</ul>
</li>
<li><p>织⼊ Weaving</p>
<ul>
<li>把切⾯（某个类）应⽤到⽬标函数的过程称为织⼊</li>
</ul>
</li>
<li><p>AOP代理</p>
<ul>
<li>AOP框架创建的对象，代理就是⽬标对象的加强</li>
<li>Spring中的AOP代理可以使JDK动态代理，也可以是CGLIB代理</li>
</ul>
</li>
</ul>
<h3 id="Advide的五种类型"><a href="#Advide的五种类型" class="headerlink" title="Advide的五种类型"></a>Advide的五种类型</h3><p>通知的注解都加在方法之前</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Before前置通知</td>
<td>在执⾏⽬标⽅法<strong>之前</strong>运⾏</td>
</tr>
<tr>
<td>@After后置通知</td>
<td>在⽬标⽅法运⾏<strong>结束之后</strong></td>
</tr>
<tr>
<td>@AfterReturning返回通知</td>
<td>在⽬标⽅法<strong>正常返回</strong>值后运⾏</td>
</tr>
<tr>
<td>@AfterThrowing异常通知</td>
<td>在⽬标⽅法<strong>出现异常</strong>后运⾏</td>
</tr>
<tr>
<td>@Around环绕通知</td>
<td>在⽬标⽅法完成<strong>前、后做增强处理</strong> ,环绕通知是最重要的通知类型 ,像事务,⽇志等都是环绕通知,注意编程中核⼼是⼀个ProceedingJoinPoint，需要⼿动执⾏ joinPoint.procced() –&gt; 需要手动调用</td>
</tr>
</tbody></table>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><ul>
<li>⽤户下单<ul>
<li>核⼼关注点：创建订单</li>
<li>横切关注点：记录⽇志、控制事务</li>
</ul>
</li>
<li>⽤户观看付费视频<ul>
<li>核⼼关注点：获取播放地址</li>
<li>横切关注点：记录⽇志、权限认证</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//⽬标类 VideoOrderService； ⾥⾯每个⽅法都是连接点，；切⼊点是CUD类型的⽅法，R读取的不作为切⼊点</span></span><br><span class="line"><span class="comment">//CRDU全称：增加(Create)、读取查询(Retrieve)、更新(Update)和删除(Delete)</span></span><br><span class="line">VideoOrderService&#123;</span><br><span class="line"> <span class="comment">//新增订单</span></span><br><span class="line"> addOrder()&#123; &#125;</span><br><span class="line"> <span class="comment">//查询订单</span></span><br><span class="line"> findOrderById()&#123;&#125;</span><br><span class="line"> <span class="comment">//删除订单</span></span><br><span class="line"> delOrder()&#123;&#125;</span><br><span class="line"> <span class="comment">//更新订单</span></span><br><span class="line"> updateOrder()&#123;&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ================================================================================================================</span></span><br><span class="line"><span class="comment">//权限切⾯类 = 切⼊点(什么地方)+通知(做什么)</span></span><br><span class="line">PermissionAspects&#123;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//切⼊点 定义了什么地⽅(过滤)</span></span><br><span class="line"> <span class="meta">@Pointcut(&quot;execution(public int net.xdclass.sp.service.VideoOrderService.*(..))&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//before 通知 表示在⽬标⽅法执⾏前切⼊, 并指定在哪个⽅法前切⼊</span></span><br><span class="line"> <span class="comment">//做什么事情，怎么做</span></span><br><span class="line"> <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">permissionCheck</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line"> System.out.println(<span class="string">&quot;在 xxx 之前执⾏权限校验&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">     ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ================================================================================================================</span></span><br><span class="line"><span class="comment">//⽇志切⾯类 = 切⼊点+通知</span></span><br><span class="line">LogAspect&#123;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">//切⼊点 定义了什么地⽅</span></span><br><span class="line"> <span class="meta">@Pointcut(&quot;execution(public int net.xdclass.sp.service.VideoOrderService.*(..))&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> <span class="comment">//after 通知 表示在⽬标⽅法执⾏后切⼊, 并指定在哪个⽅法前切⼊</span></span><br><span class="line"> <span class="comment">//什么时候，做什么事情</span></span><br><span class="line"> <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logStart</span><span class="params">()</span></span>&#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;在 xxx 之后记录⽇志&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h3><p>用于过滤连接点成为切入点的表达式</p>
<ul>
<li><p>切⼊点表示式</p>
<ul>
<li><p>除了返回类型、⽅法名和参数外，其它项都是可选的 (修饰符基本都是省略不写)</p>
</li>
<li><pre><code>    访问修饰符         返回值类型（必填）       包和类             ⽅法（必填）
execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)

&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- &amp;#96;&amp;#96;&amp;#96;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      访问修饰符 返回值类型       包和类                    ⽅法(参数)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  @Pointcut(&amp;quot;execution(public int net.xdclass.sp.service.VideoOrderService.*(..))&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;




</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>常⻅匹配语法</p>
<ul>
<li><p>*：匹配单个任何字符 或方法；</p>
</li>
<li><p>..：匹配任何数量字符,可以多个，在类型模式中匹配任何数量⼦包；在⽅法参数模式中匹配任何数量参数</p>
</li>
<li><pre><code>() 匹配⼀个不接受任何参数的⽅法
(..) 匹配⼀个接受任意数量参数的⽅法
(*) 匹配了⼀个接受⼀个任何类型的参数的⽅法
(*,Integer) 匹配了⼀个接受两个参数的⽅法，其中第⼀个参数是任意类型，第⼆个参数必须是Integer类型
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#### 常⻅例⼦&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 任意公共⽅法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
execution（public * *（..））
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 任何⼀个名字以“save”开始的⽅法&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
execution（* save*（..））
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- VideoService接⼝定义的任意⽅法（识别）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
execution（* net.xdclass.service.VideoService.*（..））
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 在service包中定义的任意⽅法（识别）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
execution（* net.xdclass.service.*.*（..））
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 匹配 service 包,⼦孙包下所有类的所有⽅法（识别）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;
execution（* net.xdclass.service..*.*（..））
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;## 代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### 基本概念&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 什么是代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 为某⼀个对象创建⼀个代理对象，程序不直接⽤原本的对象，⽽是由创建的代理对象来控制对原对象，通过代理类这中间⼀层，能有效控制对委托类对象的直接访问，也可以很好地隐藏和保护委托类对象，同时也为实施不同控制策略预留了空间&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - A -&amp;gt;B-&amp;gt; C&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 什么是静态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 由程序创建或特定⼯具⾃动⽣成源代码，在程序运⾏前，代理类的.class⽂件就已经存在&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 什么是动态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 在程序运⾏时，运⽤反射机制动态创建⽽成，⽆需⼿动编写代码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    - JDK动态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    - CGLIB动态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;### 静态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 什么是静态代理&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 由程序创建或特定⼯具⾃动⽣成源代码，在程序运⾏前，代理类的.class⽂件就已经存在通过**将⽬标类与代理类实现同⼀个接⼝**，让代理类持有真实类对象，然后在代理类⽅法中调⽤真实类⽅法，在调⽤真实类⽅法的前后添加我们所需要的功能扩展代码来达到增强的⽬的&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - A -&amp;gt; B -&amp;gt; C&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 优点&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 代理使客户端不需要知道实现类是什么，怎么做的，⽽客户端只需知道代理即可⽅便增加功能，拓展业务逻辑&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 缺点&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 代理类中出现⼤量冗余的代码，⾮常不利于扩展和维护&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 如果接⼝增加⼀个⽅法，除了所有实现类需要实现这个⽅法外，所有代理类也需要实现此⽅法。增加了代码维护的复杂度&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#96;&amp;#96;&amp;#96;java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public class StaticProxyPayServiceImpl implements PayService &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     private PayService payService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     public StaticProxyPayServiceImpl(PayService payService)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         this.payService &amp;#x3D; payService;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     public String callback(String outTradeNo) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         System.out.println(&amp;quot;StaticProxyPayServiceImpl callback begin&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         String result &amp;#x3D; payService.callback(outTradeNo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         System.out.println(&amp;quot;StaticProxyPayServiceImpl callback end&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         return result;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     public int save(int userId, int productId) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         System.out.println(&amp;quot;StaticProxyPayServiceImpl save begin&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         int id &amp;#x3D; payService.save(userId, productId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         System.out.println(&amp;quot;StaticProxyPayServiceImpl save end&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         return id;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;


</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><ul>
<li><p>什么是动态代理</p>
<ul>
<li>在程序运⾏时，运⽤反射机制动态创建⽽成，⽆需⼿动编写代码</li>
<li>JDK动态代理与静态代理⼀样，⽬标类需要实现⼀个代理接⼝,再通过代理对象调⽤⽬标⽅法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义⼀个java.lang.reflect.InvocationHandler接⼝的实现类，重写invoke⽅法</span></span><br><span class="line"><span class="comment">//Object proxy:被代理的对象</span></span><br><span class="line"><span class="comment">//Method method:要调⽤的⽅法</span></span><br><span class="line"><span class="comment">//Object[] args:⽅法调⽤时所需要参数</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvocationHandler</span> </span>&#123; </span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span>; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ul>
<li><p>即是通过编写一个能够获取代理对象以及目标方法的代理类来增强原有的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDKProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入被代理对象</span></span><br><span class="line">    <span class="keyword">private</span> Object targetObject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定代理类与被代理类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetObject 被代理类对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回代理对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(Object targetObject)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取被代理对象</span></span><br><span class="line">        <span class="keyword">this</span>.targetObject = targetObject;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ClassLoader loader 代理类的类加载器</span></span><br><span class="line"><span class="comment">        Class&lt;?&gt;[] interfaces 代理类实现的接口</span></span><br><span class="line"><span class="comment">        InvocationHandler  动态代理处理器，实际执行的代理方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">        <span class="comment">// 这里将被代理对象与代理对象绑定</span></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(targetObject.getClass().getClassLoader(),</span><br><span class="line">                targetObject.getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代理方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy   被代理的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method  要目标的⽅法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args    ⽅法调⽤时所需要参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>        目标方法的返回值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 增加额外的方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Jdk动态代理打印日志：&quot;</span>+method.getName());</span><br><span class="line">        <span class="comment">// 执行目标方法</span></span><br><span class="line">        result = method.invoke(targetObject, args);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<ul>
<li><p>CGLib动态代理的原理是对指定的业务类⽣成⼀个⼦类，并覆盖其中的业务⽅法来实现代理</p>
<p>CGLib动态代理需要springframework的支持</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibProxy</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入被代理类</span></span><br><span class="line">    <span class="keyword">private</span> Object targetObject;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定被代理类与代理类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(Object targetObject)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 注入</span></span><br><span class="line">        <span class="keyword">this</span>.targetObject = targetObject;</span><br><span class="line"></span><br><span class="line">        Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">        <span class="comment">// 设置代理类的父类（被代理类/目标类）</span></span><br><span class="line">        enhancer.setSuperclass(<span class="keyword">this</span>.targetObject.getClass());</span><br><span class="line">        <span class="comment">// 设置回调函数</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">        <span class="comment">// 创建子类（代理对象）</span></span><br><span class="line">        <span class="keyword">return</span> enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增强方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] args, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// 增强方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;通过CGLib动态代理&quot;</span>+method.getName());</span><br><span class="line">        <span class="comment">// 调用父类的方法（目标方法）</span></span><br><span class="line">        result = methodProxy.invokeSuper(o,args);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>动态代理与静态代理相⽐较</p>
<p>最⼤的好处是接⼝中声明的所有⽅法都被转移到调⽤处理器⼀个集中的⽅法中处理，解耦和易维护</p>
</li>
<li><p>两种动态代理的区别：</p>
<ul>
<li>JDK动态代理：<strong>要求⽬标对象实现⼀个接⼝</strong>，但是有时候⽬标对象只是⼀个单独的对象,并没有实现任何的接⼝,这个时候就可以⽤CGLib动态代理</li>
<li>CGLib动态代理,它是在内存中构建⼀个⼦类对象从⽽实现对⽬标对象功能的扩展</li>
<li>JDK动态代理是⾃带的，CGlib需要引⼊第三⽅包</li>
<li>CGLib动态代理基于继承来实现代理，所以<strong>⽆法对final类、private⽅法和static⽅法实现代理</strong></li>
</ul>
</li>
<li><p>Spring AOP中的代理使⽤的默认策略：</p>
<ul>
<li>如果⽬标对象实现了接⼝，则默认采⽤JDK动态代理</li>
<li>如果⽬标对象没有实现接⼝，则采⽤CgLib进⾏动态代理</li>
<li>如果⽬标对象实现了接⼝，程序⾥⾯依旧可以指定使⽤CGlib动态代理</li>
</ul>
</li>
</ul>
<h3 id="AOP实战"><a href="#AOP实战" class="headerlink" title="AOP实战"></a>AOP实战</h3><ul>
<li><p>需求分析：针对Videoservice接⼝实现⽇志打印</p>
</li>
<li><p>三个核⼼包</p>
<ul>
<li>spring-aop：AOP核⼼功能，例如代理⼯⼚</li>
<li>aspectjweaver：简单理解，⽀持切⼊点表达式</li>
<li>aspectjrt：简单理解，⽀持aop相关注解</li>
</ul>
</li>
</ul>
<ol start="0">
<li><p>添加schema</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.springframework.org/schema/aop</span><br><span class="line">http://www.springframework.org/schema/aop/spring-aop-4.2.xsd&quot;</span><br><span class="line">xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol>
<li><p>定义横切关注点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">printBefore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;printBefore 日志 time = &quot;</span> +System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">printAfter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;printAfter 日志 time = &quot;</span> +System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>




</li>
</ol>
<ol start="2">
<li><p>切面织入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    配置AOP织入--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;timeHandler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.aop.TimeHandler&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;videoService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.service.inpl.VideoServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置AOP--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--        配置切面类（横切关注点）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">&quot;timeAspect&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;timeHandler&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            配置切入点--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;allMethodLogPointcut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* site.leric.service.inpl.VideoServiceImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            配置通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;printBefore&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;allMethodLogPointcut&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;printAfter&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;allMethodLogPointcut&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
<h3 id="使用注解配置Spring"><a href="#使用注解配置Spring" class="headerlink" title="使用注解配置Spring"></a>使用注解配置Spring</h3><ul>
<li>spring的使⽤⽅式有两种 xml配置和注解</li>
<li>有些公司只⽤其中⼀种，也有公司xml 配置与注解配置⼀起使⽤<ul>
<li>注解的优势：配置简单，维护⽅便</li>
<li>xml的优势：单修改xml时不⽤改源码，不⽤重新编译和部署</li>
</ul>
</li>
<li>结论： 看团队开发规范进⾏选择，没有强调⼀定⽤哪个 更多的是xml+注解配合使⽤，⽐如spring整合mybatis</li>
</ul>
<h4 id="开启配置和包扫描"><a href="#开启配置和包扫描" class="headerlink" title="开启配置和包扫描"></a>开启配置和包扫描</h4><p>@Componet(“video”) 指定IOC扫描，并指定别名为video，若不指定别名则自动为类名的小写 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 指定扫描包路径，自动扫描子包</span></span><br><span class="line">        context.scan(<span class="string">&quot;site.leric&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 完成初始化方法,刷新IOC容器</span></span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取bean</span></span><br><span class="line">        VideoService videoService = (VideoService) context.getBean(<span class="string">&quot;VideoService&quot;</span>);</span><br><span class="line">        videoService.findByid(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>



<h4 id="讲解spring的xml和注解对⽐"><a href="#讲解spring的xml和注解对⽐" class="headerlink" title="讲解spring的xml和注解对⽐"></a>讲解spring的xml和注解对⽐</h4><ul>
<li><p>bean定义</p>
<ul>
<li><p>xml⽅式：</p>
<ul>
<li><pre><code class="xml">&lt;bean id=&quot;video&quot; class=&quot;site.leric.domain.Video3&quot;&gt;
    &lt;property name=&quot;id&quot; value=&quot;5&quot;/&gt;
    &lt;property name=&quot;title&quot; value=&quot;autowired&quot;/&gt;
&lt;/bean&gt;
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 注解⽅式：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - @Component 通⽤组件 细分：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - @Controller (⽤于web层) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - @Service (⽤于service层) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - @Repository (⽤于dao仓库层)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - &amp;#96;&amp;#96;&amp;#96;java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    @Component(&amp;quot;VideoService&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    public class VideoServiceImpl implements VideoService &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        public int save(Video video) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            System.out.println(&amp;quot;保存Video&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return 1;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
</li>
</ul>
</li>
<li><p>bean取名</p>
<ul>
<li><p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;video&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;VideoService&quot;)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>bean依赖注入</p>
<ul>
<li><p>xml利用&lt;property&gt;标签注入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;video&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;video&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注解</p>
<ul>
<li><p>类型注⼊@Autowired </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Video video;</span><br></pre></td></tr></table></figure>
</li>
<li><p>名称注⼊@Qualifier</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier(&quot;Video&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Video video;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>bean⽣命周期</p>
<ul>
<li><p>xml⽅式：init-method、destroy-method</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video3&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;初始化与销毁&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>- 注解⽅式：@PostConstruct初始化、@PreDestroy销毁

  &lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 初始化方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@PostConstruct&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Video被初始化 video1&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 销毁方法&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@PreDestroy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;  &lt;span class=&quot;title&quot;&gt;destroy&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        System.out.println(&lt;span class=&quot;string&quot;&gt;&amp;quot;Video被销毁&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;</code></pre>
<ul>
<li><p>bean作⽤范围</p>
<ul>
<li><p>xml⽅式：scope属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Video&quot;</span> <span class="attr">class</span>=<span class="string">&quot;site.leric.domain.Video&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注解⽅式：@scope注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;Video&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span> <span class="comment">// 设置bean作用范围</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Video</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
</li>
</ul>
<h3 id="管理第三方类的注解"><a href="#管理第三方类的注解" class="headerlink" title="管理第三方类的注解"></a>管理第三方类的注解</h3><ul>
<li><p>在扫描包路径范围内新建一个类作为配置类</p>
</li>
<li><p>@Configuration标注在配置类类上，相当于把该类作为spring的xml配置⽂件中的，作⽤为：配置spring容器(应⽤上下⽂)</p>
</li>
<li><p>@bean注解：⽤于告诉⽅法产⽣⼀个Bean对象，然后这个Bean对象交给Spring管理，Spring将会将这个Bean对象放在⾃⼰的IOC容器中</p>
</li>
<li><p>注意点:SpringIOC容器管理⼀个或者多个bean，这些bean都需要在@Configuration注解下进⾏创建</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 配置为IOC容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Bean(&quot;VideoOrder&quot;) // 在容器中注册bean，并取得别名</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 若写别名则bean名称为方法名+第一个字母小写</span></span><br><span class="line">    <span class="meta">@Scope(&quot;pprototype&quot;)</span></span><br><span class="line">    @</span><br><span class="line">    <span class="function"><span class="keyword">public</span> VideoOrder <span class="title">videoOrder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> VideoOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自动映射property文件"><a href="#自动映射property文件" class="headerlink" title="自动映射property文件"></a>自动映射property文件</h3><ul>
<li>@PropertySource，指定加载配置⽂件<ul>
<li>配置⽂件映射到实体类</li>
</ul>
</li>
<li>使⽤@Value映射到具体的java属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(value = &#123;&quot;classpath:config.properties&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br></pre></td></tr></table></figure>

<p>获取bean的方法必须集中放在同一个配置类中</p>
<h3 id="AOP的注解配置方式"><a href="#AOP的注解配置方式" class="headerlink" title="AOP的注解配置方式"></a>AOP的注解配置方式</h3><ul>
<li>声明切⾯类 @Aspect(切⾯): 通常是⼀个类，⾥⾯可以定义切⼊点和通知</li>
<li>配置切⼊点和通知</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// 标识扫描</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">// 标识切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAdvice</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 也可以直接在通知上填写切入点表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* site.leric.service.VideoService.*(..))&quot;)</span> <span class="comment">// 编写切入点表达式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aspect</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Before(&quot;aspect()&quot;) // 标识前置通知 指定使用的切入点</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* site.leric.service.VideoService.*(..))&quot;)</span> <span class="comment">// 也可以直接填入切入点表达式</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before log&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;aspect()&quot;)</span> <span class="comment">// 标识后置通知 指定使用的切入点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterLog</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after log&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>开启切面注解配置和扫描</p>
<ol>
<li>新建配置类</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标识为配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;site.leric&quot;)</span> <span class="comment">// 指定扫描路径</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span> <span class="comment">// 开启spring对aspect的支持</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnocationConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 里面什么都不用写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>main函数注册ioc容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启AOP的主函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AOPApp</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 把配置类的class文件传入配置容器</span></span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(AnnocationConfig.class);</span><br><span class="line">        VideoService videoService = (VideoService) context.getBean(<span class="string">&quot;VideoService&quot;</span>);</span><br><span class="line">        videoService.findByid(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ul>
<h3 id="环绕通知"><a href="#环绕通知" class="headerlink" title="环绕通知"></a>环绕通知</h3><p>可以实现前置通知与后置通知的全部功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;aspect()&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知 环绕前&quot;</span> + start);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用切入点方法</span></span><br><span class="line">    ((ProceedingJoinPoint) joinPoint).proceed();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;环绕通知 环绕后&quot;</span> + end);</span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;方法前后耗时&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Spring事务管理</p>
<ul>
<li>事务：多个操作，要么同时成功，要么失败后⼀起回滚<ul>
<li>具备ACID四种特性<ul>
<li>Atomic（原⼦性）</li>
<li>Consistency（⼀致性）</li>
<li>Isolation（隔离性）</li>
<li>Durability（持久性） </li>
</ul>
</li>
</ul>
</li>
<li>两种管理方式<ul>
<li>编程式事务管理<ul>
<li>代码中调⽤beginTransaction()、commit()、rollback()等事务管理相关的⽅法，通过TransactionTempalte**⼿动管理事务(**⽤的少)</li>
</ul>
</li>
<li>声明式事务管理<ul>
<li>通过AOP实现，可<strong>配置⽂件⽅式或者注解⽅式</strong>实现事务的管理控制(⽤的多)</li>
<li>本质是对⽅法前后进⾏拦截，底层是建⽴在 AOP 的基础之上<br>在⽬标⽅法开始之前创建或者加⼊⼀个事务，在执⾏完⽬标⽅法之后根据执⾏情况提交或者回滚事<br>务</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="事务传播行为"><a href="#事务传播行为" class="headerlink" title="事务传播行为"></a>事务传播行为</h3><p>配置是否开启新的事物</p>
<ul>
<li><p>如果在开始当前事务之前，⼀个事务上下⽂已经存在，此时有若⼲选项可以指定⼀个事务性⽅法的执⾏⾏为</p>
<ul>
<li><p>⭐@Transactional(propagation=Propagation.REQUIRED) 需要事务</p>
<p>如果有事务, 那么加⼊事务, 没有的话新建⼀个(默认情况下)</p>
</li>
<li><p>⭐ @Transactional(propagation=Propagation.NOT_SUPPORTED)  不支持事务</p>
<p>不为这个⽅法开启事务</p>
</li>
<li><p>⭐ @Transactional(propagation=Propagation.REQUIRES_NEW) 一定开一个新事务，优先执行</p>
<p>不管是否存在事务,都创建⼀个新的事务,原来的挂起,新的执⾏完毕,继续执⾏⽼的事务</p>
</li>
<li><p>⭐ @Transactional(propagation=Propagation.MANDATORY)  </p>
<p>必须在⼀个已有的事务中执⾏,否则抛出异常</p>
</li>
<li><p>@Transactional(propagation=Propagation.NEVER) </p>
<p>必须在⼀个没有的事务中执⾏,否则抛出异常(与Propagation.MANDATORY相反)</p>
</li>
<li><p>@Transactional(propagation=Propagation.SUPPORTS) 有就用，没就算了</p>
<p>如果其他bean调⽤这个⽅法,在其他bean中声明事务,那就⽤事务.如果其他bean没有声明事务,那就不⽤事务.</p>
</li>
<li><p>@Transactional(propagation=Propagation.NESTED) </p>
<p>如果当前存在事务，则创建⼀个事务作为当前事务的嵌套事务来运⾏； </p>
<p>如果当前没有事务，则该取值等价于Propagation.REQUIRED。</p>
</li>
</ul>
</li>
</ul>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>事务隔离级别: 是指若⼲个并发的事务之间的隔离程度</p>
<ul>
<li><p>@Transactional(isolation = Isolation.READ_UNCOMMITTED) 读取未提交数据</p>
<p>(会出现脏读,不可重复读) 基本不使⽤</p>
</li>
<li><p>@Transactional(isolation = Isolation.READ_COMMITTED) 读取已提交数据</p>
<p>(会出现不可重复读和幻读)</p>
</li>
<li><p>@Transactional(isolation = Isolation.REPEATABLE_READ) 可重复读</p>
<p>(会出现幻读)MySql默认</p>
</li>
<li><p>@Transactional(isolation = Isolation.SERIALIZABLE) 串⾏化</p>
<p>（最安全）</p>
</li>
</ul>
<h2 id="Spring整合SpringBoot与MyBatis"><a href="#Spring整合SpringBoot与MyBatis" class="headerlink" title="Spring整合SpringBoot与MyBatis"></a>Spring整合SpringBoot与MyBatis</h2><ul>
<li><p>快速创建SpringBoot+Spring+Mybatsi项⽬</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a></li>
</ul>
</li>
<li><p>需要加入依赖包</p>
<ul>
<li>Spring Web</li>
<li>MySQL Driver</li>
<li>MyBatis FrameWork</li>
</ul>
</li>
<li><p>配置文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.driver-class-name</span> =<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/springboot?</span></span><br><span class="line"><span class="attr">useUnicode</span>=<span class="string">true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#使⽤阿⾥巴巴druid数据源，默认使⽤⾃带的</span></span><br><span class="line"><span class="comment">#spring.datasource.type =com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">#开启控制台打印sql</span></span><br><span class="line"><span class="meta">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"></span><br><span class="line"><span class="meta">server.port</span>= <span class="string">80</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;site.lreic.SSMDemo.mapper&quot;)</span> <span class="comment">// 扫描包mapper,就不用在mapper类上再注解@MapperScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SsmDemoApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SsmDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启事务管理</p>
<ul>
<li>启动类加上  @EnableTransactionManagement</li>
<li>业务类Service层加上  @Transactional<ul>
<li>@Transactional注解默认设定 REQUIRED的事务传播(Propagation)</li>
<li>自动完成提交以及异常回滚操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>小结</strong>：通过MyBatis与数据库进行交互，通过Spring解耦各种Bean，通过SpringBoot的MVC架构处理http请求</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Leric</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lyric-git.gitee.io/leric-blog/2020/08/19/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://lyric-git.gitee.io/leric-blog/2020/08/19/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lyric-git.gitee.io/leric-blog" target="_blank">Leric</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="./tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/08/21/dtaViR.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="./2020/08/15/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="next-cover" data-lazy-src="https://s1.ax1x.com/2020/08/21/dtaViR.jpg" onerror="onerror=null;src='./img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MyBatis学习笔记</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="./2020/07/18/SSM常见注解/" title="Spring boot、Spring 常用注解"><img class="relatedPosts_cover" data-lazy-src="https://s1.ax1x.com/2020/08/21/dtaViR.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-18</div><div class="relatedPosts_title">Spring boot、Spring 常用注解</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By Leric</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="./js/utils.js"></script><script src="./js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="false" src="./js/third-party/piao.js"></script></div><script src="./live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginModelPath":"assets/","model":{"jsonPath":"./live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>